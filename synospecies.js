!function(t){var n={};function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(i,r,function(n){return t[n]}.bind(null,r));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=2)}([function(t,n){t.exports=function(t,n){if(t!==n)throw new TypeError("Cannot instantiate an arrow function")}},function(t,n){t.exports=function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}},function(t,n,e){"use strict";e.r(n);var i=e(1),r=e.n(i),a=e(0),s=e.n(a);class o{constructor(t){this._uri=t}getSparqlResultSet(t){var n=this;console.log(t);let e=encodeURIComponent(t);return fetch(this._uri+"?query="+e,{headers:{accept:"application/sparql-results+json"}}).then(function(t){if(s()(this,n),t.ok)return t.json();throw t.status}.bind(this))}getSparqlRDF(t){var n=this;console.log(t);let e=encodeURIComponent(t);return GraphNode.rdfFetch(this._uri+"?query="+e,{headers:new Headers({accept:"text/turtle"})}).then(function(t){if(s()(this,n),t.ok)return t.graph();throw t.status}.bind(this))}}let c=new o("https://lindas-data.ch/sparql");function u(t){return $rdf.sym("http://rs.tdwg.org/dwc/terms/"+t)}function d(t){return $rdf.sym("http://plazi.org/vocab/treatment#"+t)}let l={},h=new class{constructor(t){var n=this;r()(this,"_taxonNames",{}),r()(this,"_sparqlEndpoint",new o("https://query.wikidata.org/sparql")),r()(this,"_query",function(t){return s()(this,n),`\n        DESCRIBE ?item WHERE \n        {\n            ?item wdt:P225 "${t}"\n        }`}.bind(this)),this._element=t,t.innerHTML="<div>WIKIDATA</div>",t.classList.remove("hide")}addTaxon(t){var n=this;function e(t){return $rdf.sym("http://www.wikidata.org/prop/direct/"+t)}function i(t){var n=this;let i='<div>Wikidata Resource: <a href="'+t.value+'">'+t.value+"</a>";var r;return i+="<ul>",t.out(e("P225")).each(function(t){s()(this,n),i+="<li>Taxon Name "+t.value+"</li>"}.bind(this)),t.in((r="about",$rdf.sym("http://schema.org/"+r))).each(function(t){s()(this,n),i+='<li>Is subject of: <a href="'+t.value+'">'+t.value+"</a></li>"}.bind(this)),t.out(e("P846")).each(function(t){s()(this,n),i+='<li>GBIF ID <a href="https://www.gbif.org/species/'+t.value+'">'+t.value+"</a></li>"}.bind(this)),i+="</ul>",i+="</div>"}if(!this._taxonNames[t])return this._taxonNames[t]=!0,this._sparqlEndpoint.getSparqlRDF(this._query(t)).then(function(i){if(s()(this,n),0===i.length)throw Error("Not in wikidata: "+t);var r;return GraphNode((r="Q16521",$rdf.sym("http://www.wikidata.org/entity/"+r)),i).in(e("P31"))}.bind(this)).then(function(t){s()(this,n),this._element.innerHTML=this._element.innerHTML+i(t)}.bind(this))}reset(){this._element.innerHTML=""}}(document.getElementById("wikidata-area"));function p(t){var n=this;(function(t){var n=this;let e="PREFIX treat: <http://plazi.org/vocab/treatment#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX dc: <http://purl.org/dc/elements/1.1/>\nSELECT ?url ?description WHERE {   \n  ?treatment (treat:augmentsTaxonConcept|treat:definesTaxonConcept) <"+t+"> .\n  ?treatment <http://purl.org/spar/cito/cites> ?cites.\n  ?cites rdf:type fabio:Figure. \n  ?cites fabio:hasRepresentation ?url.\n  ?cites dc:description ?description.  \n} ";return c.getSparqlResultSet(e).then(function(t){var e=this;return s()(this,n),t.results.bindings.map(function(t){s()(this,e);let n={};return n.url=t.url.value,n.description=t.description.value,n}.bind(this))}.bind(this))})(t).then(function(t){var e=this;s()(this,n);var i=$("#imageTpl").html();t.forEach(function(t){if(s()(this,e),!l[t.url]){l[t.url]=!0;var n=Mustache.to_html(i,t);$("#image-area").append(n)}}.bind(this))}.bind(this))}function f(t,n){var e=this;$("#taxon-name").html(""),$("#image-area").html(""),h.reset();let i={};function r(t,n,e){var a=this;t.each(function(t){return s()(this,a),t}.bind(this)).then(function(t){var n=this;return s()(this,a),Promise.all(t.sort(function(t,e){return s()(this,n),t.value.substring(t.value.length-4)-e.value.substring(e.value.length-4)}.bind(this)).map(async function(t){var e=this;s()(this,n);let a=await t.out(u("family")).each(function(t){return s()(this,e),t.value}.bind(this)).then(function(t){return s()(this,e),t.join(", ")}.bind(this));function o(t){var n=this;return t.each(function(t){return s()(this,n),t}.bind(this)).then(function(t){var e=this;return s()(this,n),Promise.all(t.map(async function(t){var n,i=this;return s()(this,e),' <a href="'+t.value+'">'+(await t.out((n="creator",$rdf.sym("http://purl.org/dc/elements/1.1/"+n))).each(function(t){return s()(this,i),t.value}.bind(this))).join("; ")+"</a>"}.bind(this))).then(function(t){return s()(this,e),t.join(" - ")}.bind(this))}.bind(this))}let l=t.in(d("preferedName")),f=l.nodes.length>0?await o(l):"",g=t.in(d("definesTaxonConcept")),m=g.nodes.length>0?"Defined by: "+await o(g):"Defining treatment not yet on plazi",w=t.in(d("augmentsTaxonConcept")),v=w.nodes.length>0?"Augmented by: "+await o(w):"",b=$("<li>").append("<strong>"+function(t){let n=t.substring(t.lastIndexOf("/")+1),e=n.lastIndexOf("_");return n.substring(0,e).replace(new RegExp("_","g")," ")+", "+n.substring(e+1)}(t.value)+"</strong>"+f+"<br/>\nKingdom: "+t.out(u("kingdom")).value+" - Phylum: "+t.out(u("phylum")).value+" - Class: "+t.out(u("class")).value+" - Order: "+t.out(u("order")).value+" - Family: "+a+" - Genus: "+t.out(u("genus")).value+" - Species: "+t.out(u("species")).value+"<br/>"+m+"<br/>"+v);if(!i[t.value]){let n=$('<div class="deprecations">looking for deprecations....</div>');b=b.append(n),i[t.value]=!0,function(t){var n=this;let e="PREFIX treat: <http://plazi.org/vocab/treatment#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dc: <http://purl.org/dc/elements/1.1/>\nCONSTRUCT {\n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus ?genus .\n  ?tc dwc:species ?species .\n  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> .\n  ?treatment treat:preferedName ?tc.\n  ?treatment dc:creator ?treatmentCreator .\n  ?augmentingTreatment treat:augmentsTaxonConcept ?tc .\n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .  ?definingTreatment treat:definesTaxonConcept ?tc .\n  ?definingTreatment dc:creator ?definingTreatmentCreator .\n} WHERE { \n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n  ?treatment (treat:augmentsTaxonConcept|treat:definesTaxonConcept) ?tc .\n  ?treatment treat:deprecates <"+t+">.\n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus ?genus .\n  ?tc dwc:species ?species .\n  ?treatment ?treatmentTaxonRelation ?tc .\n  ?treatment dc:creator ?treatmentCreator .\n  OPTIONAL { ?augmentingTreatment treat:augmentsTaxonConcept ?tc . \n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .}\n  OPTIONAL { ?definingTreatment treat:definesTaxonConcept ?tc . \n  ?definingTreatment dc:creator ?definingTreatmentCreator .}\n }\n} ";return c.getSparqlRDF(e).then(function(t){return s()(this,n),GraphNode($rdf.sym("http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept"),t).in($rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"))}.bind(this))}(t.value).then(function(t){var i=this;s()(this,e),r(t,"Deprecated by",n),t.each(function(t){return s()(this,i),h.addTaxon(t.out(u("genus")).value+" "+t.out(u("species")).value)}.bind(this))}.bind(this))}return p(t.value),b}.bind(this)))}.bind(this)).then(function(t){s()(this,a),t.length>0?e.html(n).append($("<ul>").append(t)):e.html("")}.bind(this))}l={},function(t,n){var e=this;let i='PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX treat: <http://plazi.org/vocab/treatment#>\nPREFIX dc: <http://purl.org/dc/elements/1.1/>\nCONSTRUCT {\n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus "'+t+'" .\n  ?tc dwc:species "'+n+'" .\n  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> .\n  ?augmentingTreatment treat:augmentsTaxonConcept ?tc .\n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .  ?definingTreatment treat:definesTaxonConcept ?tc .\n  ?definingTreatment dc:creator ?definingTreatmentCreator .\n} WHERE { \n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus "'+t+'" .\n  ?tc dwc:species "'+n+'" .\n  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> . \n  OPTIONAL { ?augmentingTreatment treat:augmentsTaxonConcept ?tc . \n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .}\n  OPTIONAL { ?definingTreatment treat:definesTaxonConcept ?tc . \n  ?definingTreatment dc:creator ?definingTreatmentCreator .}\n}';return c.getSparqlRDF(i).then(function(t){return s()(this,e),GraphNode($rdf.sym("http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept"),t).in($rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"))}.bind(this))}(t,n).then(function(i){s()(this,e),0===i.nodes.length?$("#taxon-name").html("No treatment for "+t+" "+n+" found on plazi."):(window.location.hash=t+"+"+n,r(i,t+" "+n,$("#taxon-name"))),h.addTaxon(t+" "+n)}.bind(this))}let g=document.getElementById("combinedfield");!g.value&&window.location.hash&&(g.value=window.location.hash.substring(1).replace("+"," "),T());let m=g.value,w=[],v=[],b=[];function T(){$("#top-navbar").append($("#search-form")),f(g.value.toString().substring(0,g.value.toString().indexOf(" ")),g.value.toString().substr(g.value.toString().indexOf(" ")+1))}$("#lookup").on("click",function(t){return s()(this,void 0),T(),!1}.bind(void 0));var y=new Awesomplete(g);function E(){var t=this;if(-1===g.value.toString().indexOf(" "))m=g.value,Promise.all([x(g.value),C(g.value)]).then(function(n){var e=this;s()(this,t),w=w.map(function(t){return s()(this,e),t+" "}.bind(this)),y.list=w.concat(v)}.bind(this));else{m=g.value;let n=g.value.toString().substr(g.value.toString().indexOf(" ")+1),e=g.value.toString().substring(0,g.value.toString().indexOf(" "));n.length>0?R(n,e).then(function(n){var i=this;s()(this,t),y.list=b.map(function(t){return s()(this,i),e+" "+t}.bind(this))}.bind(this)):R("",e).then(function(n){var i=this;s()(this,t),y.list=b.map(function(t){return s()(this,i),e+" "+t}.bind(this))}.bind(this))}}y.maxItems=15,y.sort=!1,g.onkeyup=function(t){return s()(this,void 0),g.value.length>=2&&"Enter"!==t.key&&g.value!==m&&E(),!0}.bind(void 0),g.addEventListener("awesomplete-selectcomplete",function(t){s()(this,void 0);let n=g.value.trim().split(" ").length;1===n&&(E(),y.open()),2===n&&T()}.bind(void 0)),y.filter=function(t,n){s()(this,void 0);let e=t.toLowerCase().indexOf(n.toLowerCase());return 0===e||e===t.indexOf(" ")+1}.bind(void 0);y.item;function x(t){var n=this;let e='PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\nSELECT DISTINCT ?genus WHERE {\n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n?sub dwc:genus ?genus .\n?sub rdf:type dwcfp:TaxonName.\nFILTER REGEX(?genus, "^'+t+'","i")\n }\n} ORDER BY UCASE(?genus) LIMIT 10';return c.getSparqlResultSet(e).then(function(t){var e=this;return s()(this,n),w=t.results.bindings.map(function(t){return s()(this,e),t.genus.value}.bind(this)),!0}.bind(this))}function R(t,n){var e=this;let i='PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\nSELECT DISTINCT ?species WHERE {\n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n?sub dwc:genus "'+n+'" .\n?sub dwc:species ?species .\n?sub rdf:type dwcfp:TaxonName.\nFILTER REGEX(?species, "^'+t+'","i")\n }\n} ORDER BY UCASE(?species) LIMIT 10';return c.getSparqlResultSet(i).then(function(t){var n=this;return s()(this,e),b=t.results.bindings.map(function(t){return s()(this,n),t.species.value}.bind(this)),!0}.bind(this))}function C(t){var n=this;let e='PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\nSELECT DISTINCT ?genus ?species WHERE {\n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n?sub dwc:genus ?genus .\n?sub dwc:species ?species .\n?sub rdf:type dwcfp:TaxonName.\nFILTER REGEX(?species, "^'+t+'","i")\n }\n} ORDER BY UCASE(?species) LIMIT 10';return c.getSparqlResultSet(e).then(function(t){var e=this;return s()(this,n),v=t.results.bindings.map(function(t){return s()(this,e),t.genus.value+" "+t.species.value}.bind(this)),!0}.bind(this))}y.item=function(t,n){s()(this,void 0);t.toLowerCase().indexOf(n.toLowerCase());let e,i=t.substr(0,t.length-1).indexOf(" ");return-1===i?e="<mark>"+t.substring(0,n.length)+"</mark>"+t.substring(n.length):-1===n.indexOf(" ")?e=t.substring(0,i+1)+"<mark>"+t.substring(i+1,i+1+n.length)+"</mark>"+t.substring(i+1+n.length):-1!==n.indexOf(" ")&&(e="<mark>"+t.substring(0,n.length)+"</mark>"+t.substring(n.length)),$("<li aria-selected='false'>"+e+"</li>")[0]}.bind(void 0)}]);
//# sourceMappingURL=synospecies.js.map