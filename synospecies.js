!function(t){var n={};function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(i,r,function(n){return t[n]}.bind(null,r));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=1)}([function(t,n){t.exports=function(t,n){if(t!==n)throw new TypeError("Cannot instantiate an arrow function")}},function(t,n,e){"use strict";e.r(n);var i=e(0),r=e.n(i);e(2);class a{constructor(t){this._uri=t}getSparqlResultSet(t){var n=this;console.log(t);let e=encodeURIComponent(t);return fetch(this._uri+"?query="+e,{headers:{accept:"application/sparql-results+json"}}).then(function(t){if(r()(this,n),t.ok)return t.json();throw t.status}.bind(this))}getSparqlRDF(t){var n=this;console.log(t);let e=encodeURIComponent(t);return GraphNode.rdfFetch(this._uri+"?query="+e,{headers:new Headers({accept:"text/turtle"})}).then(function(t){if(r()(this,n),t.ok)return t.graph();throw t.status}.bind(this))}}let s=new a("https://lindas-data.ch/sparql");function o(t){return $rdf.sym("http://rs.tdwg.org/dwc/terms/"+t)}function c(t){return $rdf.sym("http://plazi.org/vocab/treatment#"+t)}let u={},d=new class{constructor(t){var n=this;this._element=t,t.innerHTML="<div>WIKIDATA</div>",t.classList.remove("hide"),this._taxonNames={},this._sparqlEndpoint=new a("https://query.wikidata.org/sparql"),this._query=function(t){return r()(this,n),`\n            DESCRIBE ?item WHERE \n            {\n                ?item wdt:P225 "${t}"\n            }`}.bind(this)}addTaxon(t){var n=this;function e(t){return $rdf.sym("http://www.wikidata.org/prop/direct/"+t)}function i(t){var n=this;let i='<div>Wikidata Resource: <a href="'+t.value+'">'+t.value+"</a>";var a;return i+="<ul>",t.out(e("P225")).each(function(t){r()(this,n),i+="<li>Taxon Name "+t.value+"</li>"}.bind(this)),t.in((a="about",$rdf.sym("http://schema.org/"+a))).each(function(t){r()(this,n),i+='<li>Is subject of: <a href="'+t.value+'">'+t.value+"</a></li>"}.bind(this)),t.out(e("P846")).each(function(t){r()(this,n),i+='<li>GBIF ID <a href="https://www.gbif.org/species/'+t.value+'">'+t.value+"</a></li>"}.bind(this)),i+="</ul>",i+="</div>"}if(!this._taxonNames[t])return this._taxonNames[t]=!0,this._sparqlEndpoint.getSparqlRDF(this._query(t)).then(function(i){if(r()(this,n),0===i.length)throw Error("Not in wikidata: "+t);var a;return GraphNode((a="Q16521",$rdf.sym("http://www.wikidata.org/entity/"+a)),i).in(e("P31"))}.bind(this)).then(function(t){r()(this,n),this._element.innerHTML=this._element.innerHTML+i(t)}.bind(this))}reset(){this._element.innerHTML=""}}(document.getElementById("wikidata-area"));function l(t){var n=this;(function(t){var n=this;let e="PREFIX treat: <http://plazi.org/vocab/treatment#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX dc: <http://purl.org/dc/elements/1.1/>\nSELECT ?url ?description WHERE {   \n  ?treatment (treat:augmentsTaxonConcept|treat:definesTaxonConcept) <"+t+"> .\n  ?treatment <http://purl.org/spar/cito/cites> ?cites.\n  ?cites rdf:type fabio:Figure. \n  ?cites fabio:hasRepresentation ?url.\n  ?cites dc:description ?description.  \n} ";return s.getSparqlResultSet(e).then(function(t){var e=this;return r()(this,n),t.results.bindings.map(function(t){r()(this,e);let n={};return n.url=t.url.value,n.description=t.description.value,n}.bind(this))}.bind(this))})(t).then(function(t){var e=this;r()(this,n);var i=$("#imageTpl").html();t.forEach(function(t){if(r()(this,e),!u[t.url]){u[t.url]=!0;var n=Mustache.to_html(i,t);$("#image-area").append(n)}}.bind(this))}.bind(this))}function h(t,n){var e=this;$("#taxon-name").html(""),$("#image-area").html(""),d.reset();let i={};function a(t,n,e){var u=this;t.each(function(t){return r()(this,u),t}.bind(this)).then(function(t){var n=this;return r()(this,u),Promise.all(t.sort(function(t,e){return r()(this,n),t.value.substring(t.value.length-4)-e.value.substring(e.value.length-4)}.bind(this)).map(async function(t){var e=this;r()(this,n);let u=await t.out(o("family")).each(function(t){return r()(this,e),t.value}.bind(this)).then(function(t){return r()(this,e),t.join(", ")}.bind(this));function h(t){var n=this;return t.each(function(t){return r()(this,n),t}.bind(this)).then(function(t){var e=this;return r()(this,n),Promise.all(t.map(async function(t){var n,i=this;return r()(this,e),' <a href="'+t.value+'">'+(await t.out((n="creator",$rdf.sym("http://purl.org/dc/elements/1.1/"+n))).each(function(t){return r()(this,i),t.value}.bind(this))).join("; ")+"</a>"}.bind(this))).then(function(t){return r()(this,e),t.join(" - ")}.bind(this))}.bind(this))}let p=t.in(c("preferedName")),g=p.nodes.length>0?await h(p):"",f=t.in(c("definesTaxonConcept")),m=f.nodes.length>0?"Defined by: "+await h(f):"Defining treatment not yet on plazi",w=t.in(c("augmentsTaxonConcept")),v=w.nodes.length>0?"Augmented by: "+await h(w):"",b=$("<li>").append("<strong>"+function(t){let n=t.substring(t.lastIndexOf("/")+1),e=n.lastIndexOf("_");return n.substring(0,e).replace(new RegExp("_","g")," ")+", "+n.substring(e+1)}(t.value)+"</strong>"+g+"<br/>\nKingdom: "+t.out(o("kingdom")).value+" - Phylum: "+t.out(o("phylum")).value+" - Class: "+t.out(o("class")).value+" - Order: "+t.out(o("order")).value+" - Family: "+u+" - Genus: "+t.out(o("genus")).value+" - Species: "+t.out(o("species")).value+"<br/>"+m+"<br/>"+v);if(!i[t.value]){let n=$('<div class="deprecations">looking for deprecations....</div>');b=b.append(n),i[t.value]=!0,function(t){var n=this;let e="PREFIX treat: <http://plazi.org/vocab/treatment#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dc: <http://purl.org/dc/elements/1.1/>\nCONSTRUCT {\n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus ?genus .\n  ?tc dwc:species ?species .\n  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> .\n  ?treatment treat:preferedName ?tc.\n  ?treatment dc:creator ?treatmentCreator .\n  ?augmentingTreatment treat:augmentsTaxonConcept ?tc .\n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .  ?definingTreatment treat:definesTaxonConcept ?tc .\n  ?definingTreatment dc:creator ?definingTreatmentCreator .\n} WHERE { \n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n  ?treatment (treat:augmentsTaxonConcept|treat:definesTaxonConcept) ?tc .\n  ?treatment treat:deprecates <"+t+">.\n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus ?genus .\n  ?tc dwc:species ?species .\n  ?treatment ?treatmentTaxonRelation ?tc .\n  ?treatment dc:creator ?treatmentCreator .\n  OPTIONAL { ?augmentingTreatment treat:augmentsTaxonConcept ?tc . \n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .}\n  OPTIONAL { ?definingTreatment treat:definesTaxonConcept ?tc . \n  ?definingTreatment dc:creator ?definingTreatmentCreator .}\n }\n} ";return s.getSparqlRDF(e).then(function(t){return r()(this,n),GraphNode($rdf.sym("http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept"),t).in($rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"))}.bind(this))}(t.value).then(function(t){var i=this;r()(this,e),a(t,"Deprecated by",n),t.each(function(t){return r()(this,i),d.addTaxon(t.out(o("genus")).value+" "+t.out(o("species")).value)}.bind(this))}.bind(this))}return l(t.value),b}.bind(this)))}.bind(this)).then(function(t){r()(this,u),t.length>0?e.html(n).append($("<ul>").append(t)):e.html("")}.bind(this))}u={},function(t,n){var e=this;let i='PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX treat: <http://plazi.org/vocab/treatment#>\nPREFIX dc: <http://purl.org/dc/elements/1.1/>\nCONSTRUCT {\n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus "'+t+'" .\n  ?tc dwc:species "'+n+'" .\n  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> .\n  ?augmentingTreatment treat:augmentsTaxonConcept ?tc .\n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .  ?definingTreatment treat:definesTaxonConcept ?tc .\n  ?definingTreatment dc:creator ?definingTreatmentCreator .\n} WHERE { \n  ?tc dwc:rank ?rank .\n  ?tc dwc:phylum ?phylum .\n  ?tc dwc:kingdom ?kingdom .\n  ?tc dwc:class ?class .\n  ?tc dwc:family ?family .\n  ?tc dwc:order ?oder .\n  ?tc dwc:genus "'+t+'" .\n  ?tc dwc:species "'+n+'" .\n  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> . \n  OPTIONAL { ?augmentingTreatment treat:augmentsTaxonConcept ?tc . \n  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .}\n  OPTIONAL { ?definingTreatment treat:definesTaxonConcept ?tc . \n  ?definingTreatment dc:creator ?definingTreatmentCreator .}\n}';return s.getSparqlRDF(i).then(function(t){return r()(this,e),GraphNode($rdf.sym("http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept"),t).in($rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"))}.bind(this))}(t,n).then(function(i){r()(this,e),0===i.nodes.length?$("#taxon-name").html("No treatment for "+t+" "+n+" found on plazi."):(window.location.hash=t+"+"+n,a(i,t+" "+n,$("#taxon-name"))),d.addTaxon(t+" "+n)}.bind(this))}let p=document.getElementById("combinedfield");!p.value&&window.location.hash&&(p.value=window.location.hash.substring(1).replace("+"," "),v());let g=p.value,f=[],m=[],w=[];function v(){$("#top-navbar").append($("#search-form")),h(p.value.toString().substring(0,p.value.toString().indexOf(" ")),p.value.toString().substr(p.value.toString().indexOf(" ")+1))}$("#lookup").on("click",function(t){return r()(this,void 0),v(),!1}.bind(void 0));var b=new Awesomplete(p);function T(){var t=this;if(-1===p.value.toString().indexOf(" "))g=p.value,Promise.all([y(p.value),x(p.value)]).then(function(n){var e=this;r()(this,t),f=f.map(function(t){return r()(this,e),t+" "}.bind(this)),b.list=f.concat(m)}.bind(this));else{g=p.value;let n=p.value.toString().substr(p.value.toString().indexOf(" ")+1),e=p.value.toString().substring(0,p.value.toString().indexOf(" "));n.length>0?E(n,e).then(function(n){var i=this;r()(this,t),b.list=w.map(function(t){return r()(this,i),e+" "+t}.bind(this))}.bind(this)):E("",e).then(function(n){var i=this;r()(this,t),b.list=w.map(function(t){return r()(this,i),e+" "+t}.bind(this))}.bind(this))}}b.maxItems=15,b.sort=!1,p.onkeyup=function(t){return r()(this,void 0),p.value.length>=2&&"Enter"!==t.key&&p.value!==g&&T(),!0}.bind(void 0),p.addEventListener("awesomplete-selectcomplete",function(t){r()(this,void 0);let n=p.value.trim().split(" ").length;1===n&&(T(),b.open()),2===n&&v()}.bind(void 0)),b.filter=function(t,n){r()(this,void 0);let e=t.toLowerCase().indexOf(n.toLowerCase());return 0===e||e===t.indexOf(" ")+1}.bind(void 0);b.item;function y(t){var n=this;let e='PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\nSELECT DISTINCT ?genus WHERE {\n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n?sub dwc:genus ?genus .\n?sub rdf:type dwcfp:TaxonName.\nFILTER REGEX(?genus, "^'+t+'","i")\n }\n} ORDER BY UCASE(?genus) LIMIT 10';return s.getSparqlResultSet(e).then(function(t){var e=this;return r()(this,n),f=t.results.bindings.map(function(t){return r()(this,e),t.genus.value}.bind(this)),!0}.bind(this))}function E(t,n){var e=this;let i='PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\nSELECT DISTINCT ?species WHERE {\n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n?sub dwc:genus "'+n+'" .\n?sub dwc:species ?species .\n?sub rdf:type dwcfp:TaxonName.\nFILTER REGEX(?species, "^'+t+'","i")\n }\n} ORDER BY UCASE(?species) LIMIT 10';return s.getSparqlResultSet(i).then(function(t){var n=this;return r()(this,e),w=t.results.bindings.map(function(t){return r()(this,n),t.species.value}.bind(this)),!0}.bind(this))}function x(t){var n=this;let e='PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\nPREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\nSELECT DISTINCT ?genus ?species WHERE {\n GRAPH <https://linked.opendata.swiss/graph/plazi> {\n?sub dwc:genus ?genus .\n?sub dwc:species ?species .\n?sub rdf:type dwcfp:TaxonName.\nFILTER REGEX(?species, "^'+t+'","i")\n }\n} ORDER BY UCASE(?species) LIMIT 10';return s.getSparqlResultSet(e).then(function(t){var e=this;return r()(this,n),m=t.results.bindings.map(function(t){return r()(this,e),t.genus.value+" "+t.species.value}.bind(this)),!0}.bind(this))}b.item=function(t,n){r()(this,void 0);t.toLowerCase().indexOf(n.toLowerCase());let e,i=t.substr(0,t.length-1).indexOf(" ");return-1===i?e="<mark>"+t.substring(0,n.length)+"</mark>"+t.substring(n.length):-1===n.indexOf(" ")?e=t.substring(0,i+1)+"<mark>"+t.substring(i+1,i+1+n.length)+"</mark>"+t.substring(i+1+n.length):-1!==n.indexOf(" ")&&(e="<mark>"+t.substring(0,n.length)+"</mark>"+t.substring(n.length)),$("<li aria-selected='false'>"+e+"</li>")[0]}.bind(void 0)},function(t,n,e){}]);
//# sourceMappingURL=synospecies.js.map