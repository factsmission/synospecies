{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/@babel/runtime/helpers/newArrowCheck.js","webpack:///./node_modules/@babel/runtime/helpers/defineProperty.js","webpack:///./src/synospecies.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","innerThis","boundThis","TypeError","obj","configurable","writable","SparqlEndpoint","constructor","uri","this","_uri","getSparqlResultSet","query","_this","console","log","encodedQuery","encodeURIComponent","fetch","headers","accept","then","response","_babel_runtime_helpers_newArrowCheck__WEBPACK_IMPORTED_MODULE_1___default","ok","json","status","getSparqlRDF","_this2","GraphNode","rdfFetch","Headers","graph","sparqlEndpoint","dwc","localName","$rdf","sym","treat","addedImages","wikidataViewer","element","_this3","_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default","taxonName","_element","innerHTML","classList","remove","addTaxon","_this5","wdt","render","gn","_this4","result","out","each","in","about","gbifId","_taxonNames","_sparqlEndpoint","_query","length","Error","reset","document","getElementById","appendImages","taxon","_this10","_this7","_this8","results","bindings","map","binding","url","description","getImages","images","_this11","template","$","html","forEach","image","Mustache","to_html","append","report","genus","species","_this19","names","tns","title","target","_this12","tn","_this13","Promise","all","sort","tn1","tn2","substring","async","_this14","family","f","fs","join","linkToTreatments","_this15","ts","_this16","_this17","links","preferedNameByGN","preferedNameBy","nodes","definingTreatmentGN","definingTreatment","augmentingTreatmentGN","augmentingTreatment","nameSection","lastIndexOf","lastSeparator","replace","RegExp","getFormattedName","deprecationsArea","oldTaxon","_this6","getNewTaxa","newTaxa","_this18","listItems","_this9","getTaxonConcepts","taxonConcepts","window","location","hash","input","lookup","previousValue","gs","cs","ss","toString","indexOf","substr","on","e","undefined","awesomplete","Awesomplete","populateSuggestions","_this21","getGenusSuggestions","getCombinedSuggestions","v","_this22","list","concat","speciesIn","genusIn","getSpeciesSuggestions","values","_this23","_this24","maxItems","onkeyup","addEventListener","wordCount","trim","split","open","filter","foundPos","toLowerCase","item","prefix","_this25","_this26","_this27","_this28","_this29","_this30","suggestion","suggestionSpacePos"],"mappings":"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","file":"synospecies.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","function _newArrowCheck(innerThis, boundThis) {\n  if (innerThis !== boundThis) {\n    throw new TypeError(\"Cannot instantiate an arrow function\");\n  }\n}\n\nmodule.exports = _newArrowCheck;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","/* global Mustache, $rdf, fetch, Promise */\n\nclass SparqlEndpoint {\n    constructor(uri) {\n        this._uri = uri;\n    }\n\n    getSparqlResultSet(query) {\n        console.log(query);\n        let encodedQuery = encodeURIComponent(query);\n        return fetch(this._uri + \"?query=\" + encodedQuery, {\n            headers: {\n                accept: \"application/sparql-results+json\"\n            }\n        }).then(response =>\n        {\n            if (!response.ok) {\n                throw response.status;\n            } else {\n                return response.json();\n            }\n        });\n    }\n    \n    getSparqlRDF(query) {\n        console.log(query);\n        let encodedQuery = encodeURIComponent(query);\n        return GraphNode.rdfFetch(this._uri + \"?query=\" + encodedQuery, {\n            headers: new Headers({\n                accept: \"text/turtle\"\n            })\n        }).then(response =>\n        {\n            if (!response.ok) {\n                throw response.status;\n            } else {\n                return response.graph();\n            }\n        });\n    }\n}\n\n\nclass WikidataViewer {\n    \n    _taxonNames = {};\n    _sparqlEndpoint = new SparqlEndpoint(\"https://query.wikidata.org/sparql\");\n\n    constructor(element) {\n        this._element = element;\n        element.innerHTML = \"<div>WIKIDATA</div>\";\n        element.classList.remove(\"hide\");\n    }\n\n    _query = taxonName =>`\n        DESCRIBE ?item WHERE \n        {\n            ?item wdt:P225 \"${taxonName}\"\n        }`;\n        \n    \n\n    /*$(\"<li>\").append(\"<strong>\" + getFormattedName(tn.value) + \"</strong>\" +\n                        preferedNameBy + \"<br/>\\n\" +\n                        \"Kingdom: \" + tn.out(dwc(\"kingdom\")).value + \" - Phylum: \" + tn.out(dwc(\"phylum\")).value +\n                        \" - Class: \" + tn.out(dwc(\"class\")).value + \" - Order: \" + tn.out(dwc(\"order\")).value +\n                        \" - Family: \" + family + \" - Genus: \" + tn.out(dwc(\"genus\")).value +\n                        \" - Species: \" + tn.out(dwc(\"species\")).value + \"<br/>\" + definingTreatment + \"<br/>\" + augmentingTreatment);*/\n\n    addTaxon(taxonName) {\n        function wdt(localName) {\n            return $rdf.sym(\"http://www.wikidata.org/prop/direct/\" + localName);\n        }\n    \n        function wd(localName) {\n            return $rdf.sym(\"http://www.wikidata.org/entity/\" + localName);\n        }\n\n        function schema(localName) {\n            return $rdf.sym(\"http://schema.org/\" + localName);\n        }\n\n        function render(gn) {\n            let result = \"<div>Wikidata Resource: <a href=\\\"\"+gn.value+\"\\\">\"+gn.value+\"</a>\";\n            result += \"<ul>\"\n            gn.out(wdt(\"P225\")).each(taxonName => {\n                result += \"<li>Taxon Name \"+taxonName.value+\"</li>\";\n            });\n            gn.in(schema(\"about\")).each(about => {\n                result += \"<li>Is subject of: <a href=\\\"\"+about.value+\"\\\">\"+about.value+\"</a></li>\";\n            });\n            gn.out(wdt(\"P846\")).each(gbifId => {\n                result += \"<li>GBIF ID <a href=\\\"https://www.gbif.org/species/\"+gbifId.value+\"\\\">\"+gbifId.value+\"</a></li>\";\n            });\n            result += \"</ul>\"\n            result += \"</div>\"\n            return result;\n        }\n        if (!this._taxonNames[taxonName]) {\n            this._taxonNames[taxonName] = true;\n            return this._sparqlEndpoint.getSparqlRDF(this._query(taxonName)).then(graph => {\n                if (graph.length === 0) {\n                    throw Error(\"Not in wikidata: \"+taxonName);\n                }\n                let tnClass = GraphNode(wd(\"Q16521\"), graph);\n                return tnClass.in(wdt(\"P31\"));\n            }).then(gn => {\n                    this._element.innerHTML = this._element.innerHTML+render(gn);    \n            });\n        }\n    };\n\n    reset() {\n        this._element.innerHTML = \"\";\n    };\n}\n\n\nlet sparqlEndpoint = new SparqlEndpoint(\"https://lindas-data.ch/sparql\");\n//let sparqlEndpoint = \"https://plazi.factsmission.com/plazi/query\";\n\n\nfunction getNewTaxa(oldTaxon) {\n    let query = \"PREFIX treat: <http://plazi.org/vocab/treatment#>\\n\" +\n            \"PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\\n\" +\n            \"PREFIX dc: <http://purl.org/dc/elements/1.1/>\\n\" +\n            \"CONSTRUCT {\\n\" +\n            \"  ?tc dwc:rank ?rank .\\n\" +\n            \"  ?tc dwc:phylum ?phylum .\\n\" +\n            \"  ?tc dwc:kingdom ?kingdom .\\n\" +\n            \"  ?tc dwc:class ?class .\\n\" +\n            \"  ?tc dwc:family ?family .\\n\" +\n            \"  ?tc dwc:order ?oder .\\n\" +\n            \"  ?tc dwc:genus ?genus .\\n\" +\n            \"  ?tc dwc:species ?species .\\n\" +\n            \"  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> .\\n\" +\n            \"  ?treatment treat:preferedName ?tc.\\n\" +\n            \"  ?treatment dc:creator ?treatmentCreator .\\n\" +\n            \"  ?augmentingTreatment treat:augmentsTaxonConcept ?tc .\\n\" +\n            \"  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .\" +\n            \"  ?definingTreatment treat:definesTaxonConcept ?tc .\\n\" +\n            \"  ?definingTreatment dc:creator ?definingTreatmentCreator .\\n\" +\n            \"} WHERE { \\n\" +\n            \" GRAPH <https://linked.opendata.swiss/graph/plazi> {\\n\" +\n            \"  ?treatment (treat:augmentsTaxonConcept|treat:definesTaxonConcept) ?tc .\\n\" +\n            \"  ?treatment treat:deprecates <\" + oldTaxon + \">.\\n\" +\n            \"  ?tc dwc:rank ?rank .\\n\" +\n            \"  ?tc dwc:phylum ?phylum .\\n\" +\n            \"  ?tc dwc:kingdom ?kingdom .\\n\" +\n            \"  ?tc dwc:class ?class .\\n\" +\n            \"  ?tc dwc:family ?family .\\n\" +\n            \"  ?tc dwc:order ?oder .\\n\" +\n            \"  ?tc dwc:genus ?genus .\\n\" +\n            \"  ?tc dwc:species ?species .\\n\" +\n            \"  ?treatment ?treatmentTaxonRelation ?tc .\\n\" +\n            \"  ?treatment dc:creator ?treatmentCreator .\\n\" +\n            \"  OPTIONAL { ?augmentingTreatment treat:augmentsTaxonConcept ?tc . \\n\" +\n            \"  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .}\\n\" +\n            \"  OPTIONAL { ?definingTreatment treat:definesTaxonConcept ?tc . \\n\" +\n            \"  ?definingTreatment dc:creator ?definingTreatmentCreator .}\\n\" +\n            \" }\\n\" +\n            \"} \";\n    return sparqlEndpoint.getSparqlRDF(query).then(graph => {\n        let tnClass = GraphNode($rdf.sym(\"http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept\"), graph);\n        return tnClass.in($rdf.sym(\"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\"));\n    });\n}\n\n\nfunction getImages(taxon) {\n    let query = \"PREFIX treat: <http://plazi.org/vocab/treatment#>\\n\" +\n            \"PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\\n\" +\n            \"PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\\n\" +\n            \"PREFIX fabio: <http://purl.org/spar/fabio/>\\n\" +\n            \"PREFIX dc: <http://purl.org/dc/elements/1.1/>\\n\" +\n            \"SELECT ?url ?description WHERE {   \\n\" +\n            \"  ?treatment (treat:augmentsTaxonConcept|treat:definesTaxonConcept) <\" + taxon + \"> .\\n\" +\n            \"  ?treatment <http://purl.org/spar/cito/cites> ?cites.\\n\" +\n            \"  ?cites rdf:type fabio:Figure. \\n\" +\n            \"  ?cites fabio:hasRepresentation ?url.\\n\" +\n            \"  ?cites dc:description ?description.  \\n\" +\n            \"} \";\n    return sparqlEndpoint.getSparqlResultSet(query).then(json => {\n        return json.results.bindings.map(binding => {\n            let result = {};\n            result.url = binding.url.value;\n            result.description = binding.description.value;\n            return result;\n        });\n    });\n\n}\n\n\nfunction getTaxonConcepts(genus, species) {\n    let query = \"PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\\n\" +\n            \"PREFIX treat: <http://plazi.org/vocab/treatment#>\\n\" +\n            \"PREFIX dc: <http://purl.org/dc/elements/1.1/>\\n\" +\n            \"CONSTRUCT {\\n\" +\n            \"  ?tc dwc:rank ?rank .\\n\" +\n            \"  ?tc dwc:phylum ?phylum .\\n\" +\n            \"  ?tc dwc:kingdom ?kingdom .\\n\" +\n            \"  ?tc dwc:class ?class .\\n\" +\n            \"  ?tc dwc:family ?family .\\n\" +\n            \"  ?tc dwc:order ?oder .\\n\" +\n            \"  ?tc dwc:genus \\\"\" + genus + \"\\\" .\\n\" +\n            \"  ?tc dwc:species \\\"\" + species + \"\\\" .\\n\" +\n            \"  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> .\\n\" +\n            \"  ?augmentingTreatment treat:augmentsTaxonConcept ?tc .\\n\" +\n            \"  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .\" +\n            \"  ?definingTreatment treat:definesTaxonConcept ?tc .\\n\" +\n            \"  ?definingTreatment dc:creator ?definingTreatmentCreator .\\n\" +\n            \"} WHERE { \\n\" +\n            \"  ?tc dwc:rank ?rank .\\n\" +\n            \"  ?tc dwc:phylum ?phylum .\\n\" +\n            \"  ?tc dwc:kingdom ?kingdom .\\n\" +\n            \"  ?tc dwc:class ?class .\\n\" +\n            \"  ?tc dwc:family ?family .\\n\" +\n            \"  ?tc dwc:order ?oder .\\n\" +\n            \"  ?tc dwc:genus \\\"\" + genus + \"\\\" .\\n\" +\n            \"  ?tc dwc:species \\\"\" + species + \"\\\" .\\n\" +\n            \"  ?tc a <http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept> . \\n\" +\n            \"  OPTIONAL { ?augmentingTreatment treat:augmentsTaxonConcept ?tc . \\n\" +\n            \"  ?augmentingTreatment dc:creator ?augmentingTreatmentCreator .}\\n\" +\n            \"  OPTIONAL { ?definingTreatment treat:definesTaxonConcept ?tc . \\n\" +\n            \"  ?definingTreatment dc:creator ?definingTreatmentCreator .}\\n\" +\n            \"}\";\n    return sparqlEndpoint.getSparqlRDF(query).then(graph => {\n        let tnClass = GraphNode($rdf.sym(\"http://filteredpush.org/ontologies/oa/dwcFP#TaxonConcept\"), graph);\n        return tnClass.in($rdf.sym(\"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\"));\n    });\n}\n\n\nfunction dwc(localName) {\n    return $rdf.sym(\"http://rs.tdwg.org/dwc/terms/\" + localName);\n}\n\nfunction treat(localName) {\n    return $rdf.sym(\"http://plazi.org/vocab/treatment#\" + localName);\n}\n\nfunction dc(localName) {\n    return $rdf.sym(\"http://purl.org/dc/elements/1.1/\" + localName);\n}\n\nlet addedImages = {};\nlet wikidataViewer = new WikidataViewer(document.getElementById(\"wikidata-area\"));\n\nfunction appendImages(taxon) {\n    getImages(taxon).then(images => {\n        var template = $('#imageTpl').html();\n        images.forEach(image => {\n            if (!addedImages[image.url]) {\n                addedImages[image.url] = true;\n                var html = Mustache.to_html(template, image);\n                $('#image-area').append(html);\n            }\n        });\n    });\n}\n\n\nfunction report(genus, species) {\n    function getFormattedName(uri) {\n        let nameSection = uri.substring(uri.lastIndexOf(\"/\") + 1);\n        let lastSeparator = nameSection.lastIndexOf(\"_\");\n        return nameSection.substring(0, lastSeparator).replace(new RegExp(\"_\", \"g\"), \" \") +\n                \", \" + nameSection.substring(lastSeparator + 1);\n    }\n    $('#taxon-name').html(\"\");\n    $('#image-area').html(\"\");\n    wikidataViewer.reset();\n    let names = {};\n    addedImages = {};\n    /* renders a graphnode (possibly one that represents multiple nodes)\n     */\n    function render(tns, title, target) {\n        tns.each(tn => tn).then(tns => Promise.all(tns.sort((tn1, tn2) => {\n                let y1 = tn1.value.substring(tn1.value.length - 4);\n                let y2 = tn2.value.substring(tn2.value.length - 4);\n                return y1 - y2;\n            }).map(async tn => {\n\n                //for unclear reasons some taxa have more than one family\n                let family = await tn.out(dwc(\"family\")).each(f => f.value).then(fs => fs.join(\", \"));\n\n                function linkToTreatments(gn) {\n                    return gn.each(t => t)\n                            .then(ts => Promise.all(ts.map(async t => \" <a href=\\\"\" + t.value + \"\\\">\" +\n                                            (await t.out(dc(\"creator\")).each(c => c.value)).join(\"; \") +\n                                            \"</a>\")).then(links => links.join(\" - \")));\n                }\n\n                let preferedNameByGN = tn.in(treat(\"preferedName\"));\n                let preferedNameBy = preferedNameByGN.nodes.length > 0 ? await linkToTreatments(preferedNameByGN) :\n                        \"\";\n\n                let definingTreatmentGN = tn.in(treat(\"definesTaxonConcept\"));\n                let definingTreatment = definingTreatmentGN.nodes.length > 0 ? \"Defined by: \" + await linkToTreatments(definingTreatmentGN) : \"Defining treatment not yet on plazi\";\n\n                let augmentingTreatmentGN = tn.in(treat(\"augmentsTaxonConcept\"));\n                let augmentingTreatment = augmentingTreatmentGN.nodes.length > 0 ? \"Augmented by: \" + await linkToTreatments(augmentingTreatmentGN) :\n                        \"\";\n\n                let result = $(\"<li>\").append(\"<strong>\" + getFormattedName(tn.value) + \"</strong>\" +\n                        preferedNameBy + \"<br/>\\n\" +\n                        \"Kingdom: \" + tn.out(dwc(\"kingdom\")).value + \" - Phylum: \" + tn.out(dwc(\"phylum\")).value +\n                        \" - Class: \" + tn.out(dwc(\"class\")).value + \" - Order: \" + tn.out(dwc(\"order\")).value +\n                        \" - Family: \" + family + \" - Genus: \" + tn.out(dwc(\"genus\")).value +\n                        \" - Species: \" + tn.out(dwc(\"species\")).value + \"<br/>\" + definingTreatment + \"<br/>\" + augmentingTreatment);\n                if (!names[tn.value]) {\n                    let deprecationsArea = $(\"<div class=\\\"deprecations\\\">looking for deprecations....</div>\");\n                    result = result.append(deprecationsArea)\n                    names[tn.value] = true;\n                    getNewTaxa(tn.value).then(newTaxa => {\n                        render(newTaxa,\"Deprecated by\", deprecationsArea);\n                        newTaxa.each(newTaxa => \n                            wikidataViewer.addTaxon(newTaxa.out(dwc(\"genus\")).value + \" \" + newTaxa.out(dwc(\"species\")).value)\n                        )\n                    });\n                }\n                appendImages(tn.value);\n                return result;\n            }))\n        ).then(listItems => {\n            if (listItems.length > 0) {\n                target.html(title).append($(\"<ul>\").append(listItems));\n            } else {\n                target.html(\"\");\n            }\n        });\n    }\n    getTaxonConcepts(genus, species).then(taxonConcepts => {\n        if (taxonConcepts.nodes.length === 0) {\n            $('#taxon-name').html(\"No treatment for \" + genus + \" \" + species + \" found on plazi.\");\n        } else {\n            window.location.hash = genus+\"+\"+species;\n            render(taxonConcepts,genus + \" \" + species, $('#taxon-name'));\n        }\n        wikidataViewer.addTaxon(genus + \" \" + species);\n    });\n}\n\n//Search field\n\nlet input = document.getElementById(\"combinedfield\");\nif (!input.value && window.location.hash) {\n    input.value = window.location.hash.substring(1).replace(\"+\",\" \");\n    lookup();\n}\nlet previousValue = input.value;\nlet gs = [];\nlet cs = [];\nlet ss = [];\n\nfunction lookup() {\n    $('#top-navbar').append($('#search-form'));\n    report(input.value.toString().substring(0, input.value.toString().indexOf(\" \")), input.value.toString().substr(input.value.toString().indexOf(\" \") + 1));\n}\n\n$(\"#lookup\").on(\"click\", e => {\n    lookup();\n    return false;\n});\n\nvar awesomplete = new Awesomplete(input);\nawesomplete.maxItems = 15;\nawesomplete.sort = false;\n\ninput.onkeyup = (e) => {\n    if ((input.value.length >= 2) && (e.key !== \"Enter\") && (input.value !== previousValue)) {\n        populateSuggestions();\n    }\n    return true;\n};\n\ninput.addEventListener(\"awesomplete-selectcomplete\", (e) => {\n    let wordCount = input.value.trim().split(\" \").length;\n    if (wordCount === 1) {\n        populateSuggestions();\n        awesomplete.open();\n    }\n    if (wordCount === 2) {\n        lookup();\n    }\n});\n\nfunction populateSuggestions() {\n    if (input.value.toString().indexOf(\" \") === -1) {\n        previousValue = input.value;\n        Promise.all([getGenusSuggestions(input.value), getCombinedSuggestions(input.value)]).then(v => {\n            gs = gs.map(i => i + \" \");\n            awesomplete.list = gs.concat(cs);\n        });\n    } else {\n        previousValue = input.value;\n        let speciesIn = input.value.toString().substr(input.value.toString().indexOf(\" \") + 1);\n        let genusIn = input.value.toString().substring(0, input.value.toString().indexOf(\" \"));\n        if (speciesIn.length > 0) {\n            getSpeciesSuggestions(speciesIn, genusIn).then(values => {\n                awesomplete.list = ss.map(i => genusIn + \" \" + i);\n            });\n        } else {\n            getSpeciesSuggestions(\"\", genusIn).then(values => {\n                awesomplete.list = ss.map(i => genusIn + \" \" + i);\n            });\n        }\n    }\n}\n\nawesomplete.filter = (t, i) => {\n    let foundPos = t.toLowerCase().indexOf(i.toLowerCase());\n    return (foundPos === 0) || (foundPos === (t.indexOf(\" \") + 1));\n};\n\nlet origItem = awesomplete.item;\nawesomplete.item = (suggestion, i) => {\n    let foundPos = suggestion.toLowerCase().indexOf(i.toLowerCase());\n    let suggestionSpacePos = suggestion.substr(0, suggestion.length - 1).indexOf(\" \");\n    let html;\n    if (suggestionSpacePos === -1) {\n        html = \"<mark>\" + suggestion.substring(0, i.length) + \"</mark>\" + suggestion.substring(i.length);\n    } else if (i.indexOf(\" \") === -1) {\n        html = suggestion.substring(0, suggestionSpacePos + 1) + \"<mark>\" +\n                suggestion.substring(suggestionSpacePos + 1, suggestionSpacePos + 1 + i.length) +\n                \"</mark>\" + suggestion.substring(suggestionSpacePos + 1 + i.length);\n    } else if (i.indexOf(\" \") !== -1) {\n        html = \"<mark>\" +\n                suggestion.substring(0, i.length) +\n                \"</mark>\" + suggestion.substring(i.length);\n    }\n    return $(\"<li aria-selected='false'>\" + html + \"</li>\")[0];\n};\n\n\n/**\n * \n * @param {type} prefix\n * @returns A promise for an array of matching genera\n */\nfunction getGenusSuggestions(prefix) {\n    let query = \"PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\\n\" +\n            \"PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\\n\" +\n            \"PREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\\n\" +\n            \"SELECT DISTINCT ?genus WHERE {\\n\" +\n            \" GRAPH <https://linked.opendata.swiss/graph/plazi> {\\n\" +\n            \"?sub dwc:genus ?genus .\\n\" +\n            \"?sub rdf:type dwcfp:TaxonName.\\n\" +\n            \"FILTER REGEX(?genus, \\\"^\" + prefix + \"\\\",\\\"i\\\")\\n\" +\n            \" }\\n\" +\n            \"} ORDER BY UCASE(?genus) LIMIT 10\";\n    return sparqlEndpoint.getSparqlResultSet(query).then(json => {\n        gs = json.results.bindings.map(binding => binding.genus.value);\n        return true;\n    });\n}\n\nfunction getSpeciesSuggestions(prefix, genus) {\n    let query = \"PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\\n\" +\n            \"PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\\n\" +\n            \"PREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\\n\" +\n            \"SELECT DISTINCT ?species WHERE {\\n\" +\n            \" GRAPH <https://linked.opendata.swiss/graph/plazi> {\\n\" +\n            \"?sub dwc:genus \\\"\" + genus + \"\\\" .\\n\" +\n            \"?sub dwc:species ?species .\\n\" +\n            \"?sub rdf:type dwcfp:TaxonName.\\n\" +\n            \"FILTER REGEX(?species, \\\"^\" + prefix + \"\\\",\\\"i\\\")\\n\" +\n            \" }\\n\" +\n            \"} ORDER BY UCASE(?species) LIMIT 10\";\n    return sparqlEndpoint.getSparqlResultSet(query).then(json => {\n        ss = json.results.bindings.map(binding => binding.species.value);\n        return true;\n    });\n}\n\nfunction getCombinedSuggestions(prefix) {\n    let query = \"PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\\n\" +\n            \"PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>\\n\" +\n            \"PREFIX dwcfp: <http://filteredpush.org/ontologies/oa/dwcFP#>\\n\" +\n            \"SELECT DISTINCT ?genus ?species WHERE {\\n\" +\n            \" GRAPH <https://linked.opendata.swiss/graph/plazi> {\\n\" +\n            \"?sub dwc:genus ?genus .\\n\" +\n            \"?sub dwc:species ?species .\\n\" +\n            \"?sub rdf:type dwcfp:TaxonName.\\n\" +\n            \"FILTER REGEX(?species, \\\"^\" + prefix + \"\\\",\\\"i\\\")\\n\" +\n            \" }\\n\" +\n            \"} ORDER BY UCASE(?species) LIMIT 10\";\n    return sparqlEndpoint.getSparqlResultSet(query).then(json => {\n        cs = json.results.bindings.map(binding => binding.genus.value + \" \" + binding.species.value);\n        return true;\n    });\n}\n"],"sourceRoot":""}